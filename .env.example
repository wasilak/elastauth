# elastauth Environment Variables
#
# This file contains example environment variables for elastauth.
# Copy this file to .env and customize the values as needed.
#
# Configuration Precedence (highest to lowest):
#   1. Environment variables (this file when loaded)
#   2. Configuration file (config.yml)
#   3. Default values
#
# ⚠️  WARNING: These are example values only!
#    DO NOT use these values in production environments!
#    Change all passwords and secrets for production use!

# ============================================================================
# Core Configuration
# ============================================================================

# Authentication provider: authelia, oidc, or casdoor
ELASTAUTH_AUTH_PROVIDER=authelia

# Encryption secret key (REQUIRED)
# Must be 64 hex characters (32 bytes for AES-256)
# Generate with: elastauth --generateKey
# Or: openssl rand -hex 32
SECRET_KEY=change_me_please

# Server configuration
ELASTAUTH_LISTEN=0.0.0.0:3000

# Logging configuration
ELASTAUTH_LOG_LEVEL=info
ELASTAUTH_LOG_FORMAT=json

# ============================================================================
# Proxy Mode Configuration
# ============================================================================

# Enable transparent proxy mode (default: false)
# When enabled, elastauth acts as a full HTTP proxy to Elasticsearch
# When disabled, elastauth operates in authentication-only mode
ELASTAUTH_PROXY_ENABLED=false

# Elasticsearch target URL for proxy mode (required when proxy enabled)
ELASTAUTH_PROXY_ELASTICSEARCH_URL=https://elasticsearch:9200

# Proxy timeout settings
ELASTAUTH_PROXY_TIMEOUT=30s
ELASTAUTH_PROXY_MAX_IDLE_CONNS=100
ELASTAUTH_PROXY_IDLE_CONN_TIMEOUT=90s

# Proxy TLS configuration
ELASTAUTH_PROXY_TLS_ENABLED=true
ELASTAUTH_PROXY_TLS_INSECURE_SKIP_VERIFY=false
ELASTAUTH_PROXY_TLS_CA_CERT=/certs/ca.crt
ELASTAUTH_PROXY_TLS_CLIENT_CERT=/certs/client.crt
ELASTAUTH_PROXY_TLS_CLIENT_KEY=/certs/client.key

# ============================================================================
# Elasticsearch Configuration
# ============================================================================

# Elasticsearch connection (for user management)
ELASTICSEARCH_HOST=http://localhost:9200
ELASTICSEARCH_USER=username
ELASTICSEARCH_PASSWORD=password

# Or use new format:
ELASTAUTH_ELASTICSEARCH_USERNAME=elastic
ELASTAUTH_ELASTICSEARCH_PASSWORD=changeme
ELASTAUTH_ELASTICSEARCH_DRY_RUN=false

# ============================================================================
# Cache Configuration
# ============================================================================

# Cache type: memory, redis, file, or empty for no caching
ELASTAUTH_CACHE_TYPE=redis

# Cache expiration time
ELASTAUTH_CACHE_EXPIRATION=1h

# Redis cache settings (when type is redis)
REDIS_HOST=redis
REDIS_DB=0
REDIS_EXPIRE_SECONDS=60

# Or use new format:
ELASTAUTH_CACHE_REDIS_HOST=redis:6379
ELASTAUTH_CACHE_REDIS_DB=0

# File cache settings (when type is file)
ELASTAUTH_CACHE_PATH=/tmp/elastauth-cache

# ============================================================================
# Authelia Provider Configuration
# ============================================================================

# Header names for Authelia authentication
ELASTAUTH_AUTHELIA_HEADER_USERNAME=Remote-User
ELASTAUTH_AUTHELIA_HEADER_GROUPS=Remote-Groups
ELASTAUTH_AUTHELIA_HEADER_EMAIL=Remote-Email
ELASTAUTH_AUTHELIA_HEADER_NAME=Remote-Name

# ============================================================================
# OIDC Provider Configuration
# ============================================================================

# OIDC provider settings
ELASTAUTH_OIDC_ISSUER=https://your-oidc-provider.com
ELASTAUTH_OIDC_CLIENT_ID=elastauth
ELASTAUTH_OIDC_CLIENT_SECRET=your-client-secret

# OIDC scopes (comma-separated)
ELASTAUTH_OIDC_SCOPES=openid,profile,email,groups

# OIDC claim mappings
ELASTAUTH_OIDC_CLAIM_MAPPINGS_USERNAME=preferred_username
ELASTAUTH_OIDC_CLAIM_MAPPINGS_EMAIL=email
ELASTAUTH_OIDC_CLAIM_MAPPINGS_GROUPS=groups
ELASTAUTH_OIDC_CLAIM_MAPPINGS_FULL_NAME=name

# OIDC advanced settings
ELASTAUTH_OIDC_CLIENT_AUTH_METHOD=client_secret_basic
ELASTAUTH_OIDC_TOKEN_VALIDATION=jwks
ELASTAUTH_OIDC_USE_PKCE=true

# ============================================================================
# Casdoor Provider Configuration
# ============================================================================

# Casdoor provider settings
ELASTAUTH_CASDOOR_ENDPOINT=https://your-casdoor-instance.com
ELASTAUTH_CASDOOR_CLIENT_ID=your-client-id
ELASTAUTH_CASDOOR_CLIENT_SECRET=your-client-secret
ELASTAUTH_CASDOOR_ORGANIZATION=built-in
ELASTAUTH_CASDOOR_APPLICATION=app-built-in

# ============================================================================
# Monitoring Configuration
# ============================================================================

# Enable Prometheus metrics
ELASTAUTH_ENABLE_METRICS=false

# Enable OpenTelemetry tracing
ELASTAUTH_ENABLE_OTEL=false

# ============================================================================
# Legacy Configuration (Deprecated)
# ============================================================================

# These variables are maintained for backward compatibility
# Use the ELASTAUTH_* prefixed versions above instead

FLASK_APP=app.py
FLASK_ENV=development
PYTHONWARNINGS="ignore:Unverified HTTPS request"
VERIFY_SSL=0
CONFIG_PATH=/app/config.yml

# ============================================================================
# Operating Mode Examples
# ============================================================================
#
# Example 1: Authentication-Only Mode with Traefik
# -------------------------------------------------
# Use elastauth as forward auth with Traefik handling proxying
#
# ELASTAUTH_AUTH_PROVIDER=authelia
# ELASTAUTH_PROXY_ENABLED=false
# ELASTAUTH_ELASTICSEARCH_USERNAME=elastic
# ELASTAUTH_ELASTICSEARCH_PASSWORD=changeme
# SECRET_KEY=your-64-char-hex-key
#
# Architecture:
#   Client → Traefik → elastauth (auth) → Traefik → Elasticsearch
#
# Example 2: Transparent Proxy Mode
# ----------------------------------
# Use elastauth as complete authentication proxy
#
# ELASTAUTH_AUTH_PROVIDER=authelia
# ELASTAUTH_PROXY_ENABLED=true
# ELASTAUTH_PROXY_ELASTICSEARCH_URL=https://elasticsearch:9200
# ELASTAUTH_ELASTICSEARCH_USERNAME=elastic
# ELASTAUTH_ELASTICSEARCH_PASSWORD=changeme
# SECRET_KEY=your-64-char-hex-key
#
# Architecture:
#   Client → elastauth (auth + proxy) → Elasticsearch
#
# ============================================================================
